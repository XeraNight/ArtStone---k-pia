import{c as _e,j as e,T as De,r as n,B as f,n as se,t as l,u as Ie,N as Pe,C as W,b as X,S as b,s as ze}from"./index-ixxTEzIM.js";import{A as Fe,a as Ve,b as qe,c as Ae,d as Te,e as Me,f as Ee,g as Oe}from"./alert-dialog-BW1F7431.js";import{D as te,d as Ze,e as ae,f as me,g as xe,F as Qe,i as ue,b as He,S as Le,R as de,B as Re}from"./AppLayout-BqQJj8es.js";import{L as m,S as L,a as R,b as B,c as U,d as _,I as z}from"./select-COUMOr2z.js";import{a as Be,u as Ue,C as he,E as Ke}from"./EmptyState-DjZh8hwW.js";import{T as ne,a as re,b as F,c as o,d as le,e as r}from"./table-8lq7_8Yr.js";import{D as $e,a as Ge,b as Je,c as Y}from"./ThemeToggle-mam2t0E5.js";import{a as We,b as Xe,c as je,d as Ye,e as es,f as ss,h as ts}from"./useInvoices-CNbxAOh_.js";import{b as pe}from"./useClients-B5nG56wM.js";import{u as ve}from"./useInventory-DcHlp9F-.js";import{T as ge}from"./textarea-6nmU1y0a.js";import{P as ee,E as as}from"./plus-_0AWnC6U.js";import{P as ns}from"./pencil-CtBFCAGF.js";import{T as ie}from"./trash-2-BweOqF1V.js";import{D as fe}from"./download-BrmPZlTB.js";import{E as rs}from"./eye-BsWZr19H.js";const ls=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],is=_e("send",ls);function cs({open:i,onOpenChange:u,invoiceNumber:x,onConfirm:h,isDeleting:j=!1}){return e.jsx(Fe,{open:i,onOpenChange:u,children:e.jsxs(Ve,{children:[e.jsxs(qe,{children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex h-12 w-12 items-center justify-center rounded-full bg-destructive/10",children:e.jsx(De,{className:"h-6 w-6 text-destructive"})}),e.jsx(Ae,{children:"Vymazať faktúru"})]}),e.jsxs(Te,{className:"text-left pt-4",children:["Naozaj chcete vymazať faktúru ",e.jsxs("strong",{className:"text-foreground",children:['"',x,'"']}),"?",e.jsx("br",{}),e.jsx("br",{}),"Táto akcia je nevratná a faktúra bude trvalo odstránená vrátane všetkých položiek."]})]}),e.jsxs(Me,{children:[e.jsx(Ee,{disabled:j,children:"Zrušiť"}),e.jsx(Oe,{onClick:S=>{S.preventDefault(),h()},disabled:j,className:"bg-destructive hover:bg-destructive/90",children:j?"Vymazávam...":"Vymazať"})]})]})})}function ds(){const[i,u]=n.useState(!1),[x,h]=n.useState("quote"),[j,S]=n.useState(""),[V,q]=n.useState(""),[A,K]=n.useState(""),[$,p]=n.useState(""),[T,N]=n.useState(0),[D,v]=n.useState(0),[c,I]=n.useState([]),[O,Z]=n.useState("custom"),[w,y]=n.useState(""),[C,Q]=n.useState(1),[M,P]=n.useState(0),E=We(),{data:k=[]}=pe(),{data:G=[]}=ve(),{data:J=[]}=Be({status:"accepted"}),{data:t}=Ue(j),s=n.useMemo(()=>c.reduce((a,g)=>a+g.quantity*g.unit_price,0),[c]),H=Math.max(0,s-T)+D,ce=H*.2,Ne=H+ce;n.useEffect(()=>{if(t&&x==="quote"&&(q(t.client_id),p(t.notes||""),N(t.discount||0),v(t.shipping||0),t.items&&t.items.length>0)){const a=t.items.map(g=>({id:Math.random().toString(36).substr(2,9),description:g.description,quantity:g.quantity,unit_price:g.unit_price,inventory_item_id:g.inventory_item_id}));I(a)}},[t,x]);const ye=a=>{S(a)},ke=a=>{if(Z(a),a==="custom")y(""),P(0);else{const g=G.find(Ce=>Ce.id===a);g&&(y(g.name),P(g.sale_price||0))}},be=()=>{if(!w){l.error("Popis položky je povinný");return}if(C<=0){l.error("Množstvo musí byť väčšie ako 0");return}const a={id:Math.random().toString(36).substr(2,9),description:w,quantity:C,unit_price:M,inventory_item_id:O==="custom"?void 0:O};I([...c,a]),Z("custom"),y(""),Q(1),P(0)},Se=a=>{I(c.filter(g=>g.id!==a))},we=async()=>{if(!V){l.error("Vyberte klienta");return}if(c.length===0){l.error("Pridajte aspoň jednu položku");return}try{await E.mutateAsync({client_id:V,quote_id:x==="quote"&&j?j:void 0,due_date:A||void 0,discount:T,shipping:D,notes:$||void 0,items:c.map(a=>({description:a.description,quantity:a.quantity,unit_price:a.unit_price,inventory_item_id:a.inventory_item_id}))}),l.success("Faktúra vytvorená"),u(!1),h("quote"),S(""),q(""),K(""),p(""),N(0),v(0),I([])}catch(a){console.error("Create invoice error:",a),l.error(a.message||"Nepodarilo sa vytvoriť faktúru"),a.details&&l.error(a.details)}};return e.jsxs(te,{open:i,onOpenChange:u,children:[e.jsx(Ze,{asChild:!0,children:e.jsxs(f,{className:"gradient-primary shadow-glow hover:shadow-lg transition-all",children:[e.jsx(ee,{className:"h-4 w-4 mr-2"}),"Nová faktúra"]})}),e.jsxs(ae,{className:"sm:max-w-[800px] max-h-[90vh] overflow-y-auto",children:[e.jsx(me,{children:e.jsx(xe,{children:"Vytvoriť novú faktúru"})}),e.jsxs("div",{className:"grid gap-6 py-4",children:[e.jsxs("div",{className:"flex gap-2 p-1 bg-muted rounded-lg",children:[e.jsxs(f,{type:"button",variant:x==="quote"?"default":"ghost",size:"sm",className:"flex-1",onClick:()=>h("quote"),children:[e.jsx(Qe,{className:"h-4 w-4 mr-2"}),"Z ponuky"]}),e.jsxs(f,{type:"button",variant:x==="scratch"?"default":"ghost",size:"sm",className:"flex-1",onClick:()=>{h("scratch"),S("")},children:[e.jsx(ns,{className:"h-4 w-4 mr-2"}),"Od začiatku"]})]}),x==="quote"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Vyberte ponuku *"}),e.jsxs(L,{value:j,onValueChange:ye,children:[e.jsx(R,{children:e.jsx(B,{placeholder:"Vyberte akceptovanú ponuku"})}),e.jsx(U,{children:J.map(a=>e.jsxs(_,{value:a.id,children:[a.quote_number," - ",a.client?.contact_name," (",a.total.toFixed(2)," €)"]},a.id))})]}),J.length===0&&e.jsx("p",{className:"text-sm text-muted-foreground",children:"Žiadne akceptované ponuky. Akceptujte ponuku alebo vytvorte faktúru od začiatku."})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Klient *"}),e.jsxs(L,{value:V,onValueChange:q,children:[e.jsx(R,{children:e.jsx(B,{placeholder:"Vyberte klienta"})}),e.jsx(U,{children:k.map(a=>e.jsxs(_,{value:a.id,children:[a.contact_name," ",a.company_name?`(${a.company_name})`:""]},a.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Splatnosť"}),e.jsx(z,{type:"date",value:A,onChange:a=>K(a.target.value)})]})]}),e.jsxs("div",{className:"space-y-4 border rounded-lg p-4 bg-muted/20",children:[e.jsxs("div",{className:"flex items-center gap-2 font-medium",children:[e.jsx(he,{className:"h-4 w-4"}),"Položky faktúry"]}),c.length>0&&e.jsxs(ne,{children:[e.jsx(re,{children:e.jsxs(F,{children:[e.jsx(o,{children:"Popis"}),e.jsx(o,{className:"w-[100px] text-right",children:"Množstvo"}),e.jsx(o,{className:"w-[120px] text-right",children:"Cena/ks"}),e.jsx(o,{className:"w-[120px] text-right",children:"Spolu"}),e.jsx(o,{className:"w-[50px]"})]})}),e.jsx(le,{children:c.map(a=>e.jsxs(F,{children:[e.jsx(r,{children:a.description}),e.jsx(r,{className:"text-right",children:a.quantity}),e.jsxs(r,{className:"text-right",children:[a.unit_price.toFixed(2)," €"]}),e.jsxs(r,{className:"text-right",children:[(a.quantity*a.unit_price).toFixed(2)," €"]}),e.jsx(r,{children:e.jsx(f,{variant:"ghost",size:"icon-sm",onClick:()=>Se(a.id),children:e.jsx(ie,{className:"h-4 w-4 text-muted-foreground hover:text-destructive"})})})]},a.id))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-12 gap-3 items-end bg-card p-3 rounded border",children:[e.jsxs("div",{className:"md:col-span-3 space-y-2",children:[e.jsx(m,{className:"text-xs",children:"Predloha (Sklad)"}),e.jsxs(L,{value:O,onValueChange:ke,children:[e.jsx(R,{className:"h-8",children:e.jsx(B,{placeholder:"Vlastná položka"})}),e.jsxs(U,{children:[e.jsx(_,{value:"custom",children:"Vlastná položka"}),G.map(a=>e.jsxs(_,{value:a.id,children:[a.name," (",a.qty_available," ks)"]},a.id))]})]})]}),e.jsxs("div",{className:"md:col-span-4 space-y-2",children:[e.jsx(m,{className:"text-xs",children:"Popis *"}),e.jsx(z,{className:"h-8",value:w,onChange:a=>y(a.target.value),placeholder:"Názov položky alebo služby"})]}),e.jsxs("div",{className:"md:col-span-2 space-y-2",children:[e.jsx(m,{className:"text-xs",children:"Množstvo *"}),e.jsx(z,{type:"number",className:"h-8",min:"1",value:C,onChange:a=>Q(parseInt(a.target.value)||0)})]}),e.jsxs("div",{className:"md:col-span-2 space-y-2",children:[e.jsx(m,{className:"text-xs",children:"Cena/ks (€)"}),e.jsx(z,{type:"number",className:"h-8",min:"0",step:"0.01",value:M,onChange:a=>P(parseFloat(a.target.value)||0)})]}),e.jsx("div",{className:"md:col-span-1",children:e.jsx(f,{size:"sm",className:"w-full h-8",onClick:be,children:e.jsx(ee,{className:"h-4 w-4"})})})]}),e.jsxs("div",{className:"flex justify-end gap-8 pt-4 border-t",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Základ (bez DPH)"}),e.jsxs("p",{className:"font-medium",children:[s.toFixed(2)," €"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"DPH (20%)"}),e.jsxs("p",{className:"font-medium",children:[ce.toFixed(2)," €"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Spolu s DPH"}),e.jsxs("p",{className:"text-xl font-bold text-primary",children:[Ne.toFixed(2)," €"]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Poznámka"}),e.jsx(ge,{placeholder:"Interná poznámka k faktúre...",value:$,onChange:a=>p(a.target.value)})]})]}),e.jsxs(ue,{children:[e.jsx(f,{variant:"outline",onClick:()=>u(!1),children:"Zrušiť"}),e.jsx(f,{onClick:we,disabled:E.isPending,children:E.isPending?e.jsxs(e.Fragment,{children:[e.jsx(se,{className:"mr-2 h-4 w-4 animate-spin"}),"Vytváram..."]}):"Vytvoriť faktúru"})]})]})]})}const os={draft:"Návrh",sent:"Odoslaná",paid:"Zaplatená",overdue:"Po splatnosti",cancelled:"Zrušená"};function ms({invoice:i,open:u,onOpenChange:x}){const[h,j]=n.useState(""),[S,V]=n.useState(""),[q,A]=n.useState("draft"),[K,$]=n.useState(""),[p,T]=n.useState([]),[N,D]=n.useState("custom"),[v,c]=n.useState(""),[I,O]=n.useState(1),[Z,w]=n.useState(0),y=Xe(),{data:C=[]}=pe(),{data:Q=[]}=ve();n.useEffect(()=>{i&&u&&(j(i.client_id),V(i.due_date||""),A(i.status),$(i.notes||""),i.items?T(i.items.map(s=>({id:Math.random().toString(36).substr(2,9),db_id:s.id,description:s.description,quantity:s.quantity,unit_price:s.unit_price,inventory_item_id:s.inventory_item_id}))):T([]))},[i,u]);const M=n.useMemo(()=>p.reduce((s,d)=>s+d.quantity*d.unit_price,0),[p]),P=M*.2,E=M+P,k=s=>{if(D(s),s==="custom")c(""),w(0);else{const d=Q.find(H=>H.id===s);d&&(c(d.name),w(d.sale_price||0))}},G=()=>{if(!v){l.error("Popis položky je povinný");return}if(I<=0){l.error("Množstvo musí byť väčšie ako 0");return}const s={id:Math.random().toString(36).substr(2,9),description:v,quantity:I,unit_price:Z,inventory_item_id:N==="custom"?void 0:N};T([...p,s]),D("custom"),c(""),O(1),w(0)},J=s=>{T(p.filter(d=>d.id!==s))},t=async()=>{if(i){if(!h){l.error("Vyberte klienta");return}if(p.length===0){l.error("Pridajte aspoň jednu položku");return}try{await y.mutateAsync({id:i.id,client_id:h,due_date:S||void 0,status:q,notes:K||void 0,items:p.map(s=>({description:s.description,quantity:s.quantity,unit_price:s.unit_price,inventory_item_id:s.inventory_item_id}))}),l.success("Faktúra bola aktualizovaná"),x(!1)}catch(s){console.error("Update invoice error:",s),l.error(s.message||"Nepodarilo sa aktualizovať faktúru")}}};return!i&&u?e.jsx(te,{open:u,onOpenChange:x,children:e.jsx(ae,{children:e.jsxs("div",{className:"flex flex-col items-center justify-center h-40 space-y-4",children:[e.jsx(se,{className:"h-8 w-8 animate-spin text-primary"}),e.jsx("p",{className:"text-muted-foreground",children:"Načítavam detaily faktúry..."})]})})}):e.jsx(te,{open:u,onOpenChange:x,children:e.jsxs(ae,{className:"sm:max-w-[800px] max-h-[90vh] overflow-y-auto",children:[e.jsx(me,{children:e.jsxs(xe,{children:["Detail faktúry ",i?.invoice_number]})}),e.jsxs("div",{className:"grid gap-6 py-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Klient"}),e.jsxs(L,{value:h,onValueChange:j,children:[e.jsx(R,{children:e.jsx(B,{placeholder:"Vyberte klienta"})}),e.jsx(U,{children:C.map(s=>e.jsx(_,{value:s.id,children:s.contact_name},s.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Splatnosť"}),e.jsx(z,{type:"date",value:S,onChange:s=>V(s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Status"}),e.jsxs(L,{value:q,onValueChange:s=>A(s),children:[e.jsx(R,{children:e.jsx(B,{})}),e.jsx(U,{children:Object.entries(os).map(([s,d])=>e.jsx(_,{value:s,children:d},s))})]})]})]}),e.jsxs("div",{className:"space-y-4 border rounded-lg p-4 bg-muted/20",children:[e.jsxs("div",{className:"flex items-center gap-2 font-medium",children:[e.jsx(he,{className:"h-4 w-4"}),"Položky faktúry"]}),e.jsx("div",{className:"rounded-md border bg-card",children:e.jsxs(ne,{children:[e.jsx(re,{children:e.jsxs(F,{children:[e.jsx(o,{children:"Popis"}),e.jsx(o,{className:"w-[100px] text-right",children:"Množstvo"}),e.jsx(o,{className:"w-[120px] text-right",children:"Cena/ks"}),e.jsx(o,{className:"w-[120px] text-right",children:"Spolu"}),e.jsx(o,{className:"w-[50px]"})]})}),e.jsxs(le,{children:[p.length===0&&e.jsx(F,{children:e.jsx(r,{colSpan:5,className:"text-center text-muted-foreground py-8",children:"Žiadne položky"})}),p.map(s=>e.jsxs(F,{children:[e.jsx(r,{children:s.description}),e.jsx(r,{className:"text-right",children:s.quantity}),e.jsxs(r,{className:"text-right",children:[s.unit_price.toFixed(2)," €"]}),e.jsxs(r,{className:"text-right",children:[(s.quantity*s.unit_price).toFixed(2)," €"]}),e.jsx(r,{children:e.jsx(f,{variant:"ghost",size:"icon-sm",onClick:()=>J(s.id),children:e.jsx(ie,{className:"h-4 w-4 text-muted-foreground hover:text-destructive"})})})]},s.id))]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-12 gap-3 items-end bg-card p-3 rounded border",children:[e.jsxs("div",{className:"md:col-span-3 space-y-2",children:[e.jsx(m,{className:"text-xs",children:"Sklad"}),e.jsxs(L,{value:N,onValueChange:k,children:[e.jsx(R,{className:"h-8",children:e.jsx(B,{placeholder:"Vlastná položka"})}),e.jsxs(U,{children:[e.jsx(_,{value:"custom",children:"Vlastná položka"}),Q.map(s=>e.jsx(_,{value:s.id,children:s.name},s.id))]})]})]}),e.jsxs("div",{className:"md:col-span-4 space-y-2",children:[e.jsx(m,{className:"text-xs",children:"Popis"}),e.jsx(z,{className:"h-8",value:v,onChange:s=>c(s.target.value)})]}),e.jsxs("div",{className:"md:col-span-2 space-y-2",children:[e.jsx(m,{className:"text-xs",children:"Počet"}),e.jsx(z,{type:"number",className:"h-8",value:I,onChange:s=>O(Number(s.target.value))})]}),e.jsxs("div",{className:"md:col-span-2 space-y-2",children:[e.jsx(m,{className:"text-xs",children:"Cena (€)"}),e.jsx(z,{type:"number",className:"h-8",value:Z,onChange:s=>w(Number(s.target.value))})]}),e.jsx("div",{className:"md:col-span-1",children:e.jsx(f,{size:"sm",className:"w-full h-8",onClick:G,children:e.jsx(ee,{className:"h-4 w-4"})})})]}),e.jsxs("div",{className:"flex justify-end gap-8 pt-4 border-t",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Základ (bez DPH)"}),e.jsxs("p",{className:"font-medium",children:[M.toFixed(2)," €"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"DPH (20%)"}),e.jsxs("p",{className:"font-medium",children:[P.toFixed(2)," €"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Spolu s DPH"}),e.jsxs("p",{className:"text-xl font-bold text-primary",children:[E.toFixed(2)," €"]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Poznámka"}),e.jsx(ge,{value:K,onChange:s=>$(s.target.value)})]})]}),e.jsxs(ue,{className:"gap-2 sm:gap-0",children:[e.jsx("div",{className:"flex-1 flex justify-start",children:e.jsxs(f,{variant:"secondary",onClick:()=>{try{if(!i){l.error("Chýbajú dáta faktúry");return}je(i),l.success("PDF sa generuje...")}catch(s){console.error("PDF generation failed:",s),l.error("Chyba pri generovaní PDF: "+s.message)}},children:[e.jsx(fe,{className:"h-4 w-4 mr-2"}),"Stiahnuť PDF"]})}),e.jsx(f,{variant:"outline",onClick:()=>x(!1),children:"Zrušiť"}),e.jsx(f,{onClick:t,disabled:y.isPending,children:y.isPending?e.jsx(se,{className:"mr-2 h-4 w-4 animate-spin"}):"Uložiť zmeny"})]})]})})}const oe={draft:"Návrh",sent:"Odoslaná",paid:"Zaplatená",overdue:"Po splatnosti",cancelled:"Zrušená"},xs={draft:"secondary",sent:"info",paid:"success",overdue:"destructive",cancelled:"warning"};function Is(){const{user:i}=Ie(),[u,x]=n.useState(""),[h,j]=n.useState("all"),[S,V]=n.useState(null),[q,A]=n.useState(!1),[K,$]=n.useState(!1),[p,T]=n.useState(null),[N,D]=n.useState(null);if(i?.role==="sales")return e.jsx(Pe,{to:"/dashboard",replace:!0});const{data:v,isLoading:c,isError:I,error:O}=Ye({status:h!=="all"?h:void 0,search:u||void 0}),{data:Z}=es(S||""),w=ss(),y=ts(),C=t=>new Intl.NumberFormat("sk-SK",{style:"currency",currency:"EUR"}).format(t),Q=v?.reduce((t,s)=>t+s.total,0)||0,M=v?.filter(t=>t.status==="paid").reduce((t,s)=>t+s.total,0)||0,P=v?.filter(t=>t.status==="overdue").reduce((t,s)=>t+s.total,0)||0,E=async(t,s)=>{try{await w.mutateAsync({invoiceId:t,status:s}),l.success("Status faktúry aktualizovaný")}catch{l.error("Nepodarilo sa aktualizovať status")}},k=t=>{V(t),A(!0)},G=async(t,s)=>{try{const{data:d,error:H}=await ze.from("invoices").select(`
          *,
          client:clients(id, contact_name, company_name, email, phone, address),
          items:invoice_items(*)
        `).eq("id",t).single();if(H)throw H;d&&(je(d),l.success("PDF faktúry vygenerované"))}catch(d){console.error("Error generating PDF:",d),l.error("Nepodarilo sa vygenerovať PDF")}},J=async()=>{if(N)try{await y.mutateAsync(N.id),l.success("Faktúra vymazaná"),D(null)}catch(t){console.error("Delete error:",t),l.error("Nepodarilo sa vymazať faktúru")}};return e.jsx(He,{title:"Faktúry",children:e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-between",children:[e.jsxs("div",{className:"flex flex-1 gap-3",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(Le,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(z,{placeholder:"Hľadať podľa čísla, klienta...",value:u,onChange:t=>x(t.target.value),className:"pl-9"})]}),e.jsxs(L,{value:h,onValueChange:j,children:[e.jsx(R,{className:"w-40",children:e.jsx(B,{placeholder:"Status"})}),e.jsxs(U,{children:[e.jsx(_,{value:"all",children:"Všetky statusy"}),Object.entries(oe).map(([t,s])=>e.jsx(_,{value:t,children:s},t))]})]})]}),e.jsx(ds,{})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[e.jsx(W,{className:"shadow-soft",children:e.jsx(X,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Celkom faktúr"}),c?e.jsx(b,{className:"h-8 w-16 mt-1"}):e.jsx("p",{className:"text-2xl font-semibold",children:v?.length||0})]}),e.jsx(de,{className:"h-8 w-8 text-muted-foreground/50"})]})})}),e.jsx(W,{className:"shadow-soft",children:e.jsx(X,{className:"pt-6",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Celková hodnota"}),c?e.jsx(b,{className:"h-8 w-24 mt-1"}):e.jsx("p",{className:"text-2xl font-semibold",children:C(Q)})]})})}),e.jsx(W,{className:"shadow-soft",children:e.jsx(X,{className:"pt-6",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Zaplatené"}),c?e.jsx(b,{className:"h-8 w-24 mt-1"}):e.jsx("p",{className:"text-2xl font-semibold text-success",children:C(M)})]})})}),e.jsx(W,{className:"shadow-soft",children:e.jsx(X,{className:"pt-6",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Po splatnosti"}),c?e.jsx(b,{className:"h-8 w-24 mt-1"}):e.jsx("p",{className:"text-2xl font-semibold text-destructive",children:C(P)})]})})})]}),e.jsx(W,{className:"shadow-soft",children:e.jsx(X,{className:"p-0",children:e.jsxs(ne,{children:[e.jsx(re,{children:e.jsxs(F,{children:[e.jsx(o,{children:"Číslo"}),e.jsx(o,{children:"Klient"}),e.jsx(o,{children:"Status"}),e.jsx(o,{className:"text-right",children:"Suma"}),e.jsx(o,{children:"Splatnosť"}),e.jsx(o,{children:"Vytvoril"}),e.jsx(o,{className:"w-12"})]})}),e.jsx(le,{children:c?Array.from({length:5}).map((t,s)=>e.jsxs(F,{children:[e.jsx(r,{children:e.jsx(b,{className:"h-5 w-24"})}),e.jsx(r,{children:e.jsx(b,{className:"h-5 w-32"})}),e.jsx(r,{children:e.jsx(b,{className:"h-5 w-20"})}),e.jsx(r,{children:e.jsx(b,{className:"h-5 w-20"})}),e.jsx(r,{children:e.jsx(b,{className:"h-5 w-24"})}),e.jsx(r,{children:e.jsx(b,{className:"h-5 w-28"})}),e.jsx(r,{children:e.jsx(b,{className:"h-5 w-8"})})]},s)):v?.length===0?e.jsx(F,{children:e.jsx(r,{colSpan:7,className:"p-0",children:e.jsx(Ke,{icon:e.jsx(de,{className:"h-full w-full"}),title:"Zatiaľ žiadne faktúry",description:"Vytvorte faktúru z akceptovanej ponuky alebo od začiatku.",action:{label:"Vytvoriť faktúru",onClick:()=>setCreateDialogOpen(!0),icon:e.jsx(ee,{className:"h-4 w-4"})}})})}):v?.map(t=>e.jsxs(F,{className:"cursor-pointer hover:bg-muted/50",children:[e.jsx(r,{onClick:()=>k(t.id),children:e.jsx("span",{className:"font-medium text-foreground",children:t.invoice_number})}),e.jsx(r,{onClick:()=>k(t.id),children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-foreground",children:t.client?.contact_name||"-"}),t.client?.company_name&&e.jsx("p",{className:"text-sm text-muted-foreground",children:t.client.company_name})]})}),e.jsx(r,{onClick:()=>k(t.id),children:e.jsx(Re,{variant:xs[t.status],children:oe[t.status]})}),e.jsx(r,{className:"text-right font-medium",onClick:()=>k(t.id),children:C(t.total)}),e.jsx(r,{onClick:()=>k(t.id),children:e.jsx("span",{className:`text-sm ${t.status==="overdue"?"text-destructive font-medium":"text-muted-foreground"}`,children:t.due_date?new Date(t.due_date).toLocaleDateString("sk-SK"):"-"})}),e.jsx(r,{onClick:()=>k(t.id),children:e.jsx("span",{className:"text-sm text-muted-foreground",children:t.created_by_user?.full_name||"-"})}),e.jsx(r,{children:e.jsxs($e,{children:[e.jsx(Ge,{asChild:!0,children:e.jsx(f,{variant:"ghost",size:"icon-sm",children:e.jsx(as,{className:"h-4 w-4"})})}),e.jsxs(Je,{align:"end",children:[e.jsxs(Y,{onClick:()=>k(t.id),children:[e.jsx(rs,{className:"h-4 w-4 mr-2"}),"Zobraziť / Upraviť"]}),e.jsxs(Y,{onClick:()=>G(t.id,t.invoice_number),children:[e.jsx(fe,{className:"h-4 w-4 mr-2"}),"Stiahnuť PDF"]}),t.status==="draft"&&e.jsxs(Y,{onClick:()=>E(t.id,"sent"),children:[e.jsx(is,{className:"h-4 w-4 mr-2"}),"Odoslať klientovi"]}),t.status==="sent"&&e.jsx(Y,{onClick:()=>E(t.id,"paid"),children:"Označiť ako zaplatenú"}),e.jsxs(Y,{className:"text-destructive",onClick:()=>D({id:t.id,number:t.invoice_number}),children:[e.jsx(ie,{className:"h-4 w-4 mr-2"}),"Vymazať"]})]})]})})]},t.id))})]})})}),e.jsx(ms,{open:q,onOpenChange:A,invoice:Z||null}),e.jsx(cs,{open:!!N,onOpenChange:t=>!t&&D(null),invoiceNumber:N?.number||"",onConfirm:J,isDeleting:y.isPending})]})})}export{Is as default};
