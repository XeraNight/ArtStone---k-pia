import{u as d,s as a,_ as g}from"./index-ixxTEzIM.js";import{u as c}from"./ThemeToggle-mam2t0E5.js";function h(){const{user:e}=d();return c({queryKey:["salespeople"],queryFn:async()=>{let n=a.from("profiles").select(`
          *,
          region:regions(id, name)
        `).eq("role","sales").eq("is_active",!0);e?.role==="manager"&&e.regionId&&(n=n.eq("region_id",e.regionId));const{data:s,error:r}=await n;if(r)throw r;return await Promise.all((s||[]).map(async t=>{const[l,i,u]=await Promise.all([a.from("leads").select("*",{count:"exact",head:!0}).eq("assigned_user_id",t.id),a.from("clients").select("*",{count:"exact",head:!0}).eq("assigned_user_id",t.id),a.from("quotes").select("*",{count:"exact",head:!0}).eq("created_by",t.id)]);return{...t,role:"sales",stats:{leads:l.count||0,clients:i.count||0,quotes:u.count||0}}}))},enabled:!!e&&(e.role==="admin"||e.role==="manager")})}function p(){const{user:e}=d(),n=e?.id?.startsWith("admin-")||e?.id?.startsWith("manager-")||e?.id?.startsWith("sales-");return c({queryKey:["all-users"],queryFn:async()=>{if(console.log("=== Fetching all users ==="),console.log("Current user role:",e?.role),console.log("Current user regionId:",e?.regionId),console.log("Is demo user:",n),n){console.log("Using demo profiles for demo user");const{demoProfiles:s}=await g(async()=>{const{demoProfiles:o}=await import("./demoData-tljgfLqM.js");return{demoProfiles:o}},[]);let r=s;return e?.role==="manager"&&e.regionId&&(r=s.filter(o=>o.region_id===e.regionId||o.role==="admin")),console.log("Demo profiles count:",r.length),r.map(o=>({...o,role:o.role}))}try{let s=a.from("profiles").select("*").order("full_name");e?.role==="manager"&&e.regionId&&(s=s.eq("region_id",e.regionId),console.log("Manager filter applied for region:",e.regionId));let{data:r,error:o}=await s;if(o)throw console.error("Error fetching users:",o),o;if(console.log("Fetched profiles (without region data):",r),console.log("Total profiles count:",r?.length||0),r&&r.length>0){const t=[...new Set(r.map(l=>l.region_id).filter(Boolean))];if(t.length>0){const{data:l}=await a.from("regions").select("id, name").in("id",t);console.log("Fetched regions:",l),r=r.map(i=>({...i,region:i.region_id&&l&&l.find(u=>u.id===i.region_id)||null}))}}return(r||[]).map(t=>({...t,role:t.role||"sales"}))}catch(s){throw console.error("useAllUsers query failed:",s),s}},enabled:!!e&&(e.role==="admin"||e.role==="manager")})}export{p as a,h as u};
