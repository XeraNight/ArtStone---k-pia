import{u as _}from"./ThemeToggle-BXFLgX7M.js";import{u as o,o as d,s as r}from"./index-DjLyfeQv.js";import{u as l}from"./AppLayout-I815TcDq.js";const c=[{id:"1",contact_name:"Peter Krátky",company_name:"TechSolutions s.r.o.",email:"kratky@techsolutions.sk",phone:"+421 905 123 456",address:"Priemyselná 5, Bratislava",postal_code:"821 09",region_id:"1",status:"active",assigned_user_id:"1",lead_origin_id:null,total_value:15400,notes:"Kľúčový klient pre IT služby",created_by:"1",created_at:new Date(Date.now()-7776e6).toISOString(),updated_at:new Date().toISOString(),assigned_user:{id:"1",full_name:"Ján Novák",email:"jan@example.com",phone:null,avatar_url:null,region_id:null,theme_preference:"system",is_active:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}},{id:"2",contact_name:"Eva Malá",company_name:"Design Studio",email:"eva@designstudio.sk",phone:"+421 903 987 654",address:"Hlavná 23, Košice",postal_code:"040 01",region_id:"3",status:"active",assigned_user_id:"1",lead_origin_id:null,total_value:5200,notes:"Pravidelný odberateľ grafických prác",created_by:"1",created_at:new Date(Date.now()-5184e6).toISOString(),updated_at:new Date().toISOString(),assigned_user:{id:"1",full_name:"Ján Novák",email:"jan@example.com",phone:null,avatar_url:null,region_id:null,theme_preference:"system",is_active:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}},{id:"3",contact_name:"Ing. Jozef Varga",company_name:"StavbaDom s.r.o.",email:"varga@stavbadom.sk",phone:"+421 948 222 333",address:"Dlhá 11, Nitra",postal_code:"949 01",region_id:"2",status:"inactive",assigned_user_id:"2",lead_origin_id:null,total_value:28e3,notes:"Momentálne bez aktívnych projektov",created_by:"2",created_at:new Date(Date.now()-15552e6).toISOString(),updated_at:new Date().toISOString(),assigned_user:{id:"2",full_name:"Mária Kováčová",email:"maria@example.com",phone:null,avatar_url:null,region_id:null,theme_preference:"system",is_active:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}},{id:"4",contact_name:"MUDr. Alena Novotná",company_name:"Súkromná ambulancia",email:"novotna@ambulancia.sk",phone:"+421 911 555 666",address:"Nemocničná 8, Trenčín",postal_code:"911 01",region_id:"4",status:"prospect",assigned_user_id:"1",lead_origin_id:null,total_value:0,notes:"Záujem o nový zdravotnícky softvér",created_by:"1",created_at:new Date(Date.now()-6048e5).toISOString(),updated_at:new Date().toISOString(),assigned_user:{id:"1",full_name:"Ján Novák",email:"jan@example.com",phone:null,avatar_url:null,region_id:null,theme_preference:"system",is_active:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}},{id:"5",contact_name:"Peter Nagy",company_name:null,email:"nagy.peter@gmail.com",phone:"+421 908 777 888",address:null,postal_code:null,region_id:"1",status:"completed",assigned_user_id:"2",lead_origin_id:null,total_value:1200,notes:"Jednorazová konzultácia",created_by:"2",created_at:new Date(Date.now()-2592e6).toISOString(),updated_at:new Date().toISOString(),assigned_user:{id:"2",full_name:"Mária Kováčová",email:"maria@example.com",phone:null,avatar_url:null,region_id:null,theme_preference:"system",is_active:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}}];function y(t){const{user:i,isDemo:e}=o();return _({queryKey:["clients",t],queryFn:async()=>{let a=[];if(console.log("useClients: fetching",{isDemo:e,filters:t}),e)a=[...c];else{const{data:n,error:s}=await r.from("clients").select("*").order("created_at",{ascending:!1});if(s)throw console.error("Error fetching clients:",s),s;console.log("useClients: fetched",n),a=n}return a},enabled:!!i,staleTime:1e3*60*5,retry:2,refetchOnWindowFocus:!1})}function v(){const t=d(),{user:i}=o();return l({mutationFn:async e=>{const{data:a,error:n}=await r.from("clients").insert({contact_name:e.contact_name,company_name:e.company_name,email:e.email,phone:e.phone,address:e.address,postal_code:e.postal_code,region_id:e.region_id,status:e.status||"prospect",notes:e.notes,assigned_user_id:e.assigned_user_id||i?.id,lead_origin_id:e.lead_origin_id,created_by:i?.id}).select().single();if(n)throw n;return a},onSuccess:()=>{t.invalidateQueries({queryKey:["clients"]}),t.invalidateQueries({queryKey:["dashboard-stats"]})}})}function S(){const t=d(),{user:i}=o();return l({mutationFn:async({id:e,...a})=>{const{data:n}=await r.from("clients").select("assigned_user_id,contact_name,company_name").eq("id",e).single(),{data:s,error:u}=await r.from("clients").update({...a,updated_at:new Date().toISOString()}).eq("id",e).select().single();if(u)throw u;return a.assigned_user_id&&n?.assigned_user_id!==a.assigned_user_id&&a.assigned_user_id!==i?.id&&await r.from("notifications").insert({user_id:a.assigned_user_id,type:"new_client",title:"Nový klient priradený",message:`Klient ${n?.contact_name||n?.company_name||"bol"} vám bol priradený`,entity_type:"client",entity_id:e}),s},onSuccess:e=>{t.invalidateQueries({queryKey:["clients"]}),t.invalidateQueries({queryKey:["clients",e.id]}),t.invalidateQueries({queryKey:["dashboard-stats"]})}})}function f(){const t=d();return l({mutationFn:async i=>{const{error:e}=await r.from("clients").delete().eq("id",i);if(e)throw e},onSuccess:()=>{t.invalidateQueries({queryKey:["clients"]}),t.invalidateQueries({queryKey:["dashboard-stats"]})}})}export{S as a,y as b,f as c,c as d,v as u};
