import{u as m}from"./ThemeToggle-BXFLgX7M.js";import{u as v,o as _,s as i}from"./index-DjLyfeQv.js";import{u as l}from"./AppLayout-I815TcDq.js";const f=[{id:"1",name:"Hardware",created_at:new Date().toISOString()},{id:"2",name:"Software",created_at:new Date().toISOString()},{id:"3",name:"Služby",created_at:new Date().toISOString()},{id:"4",name:"Kancelárske potreby",created_at:new Date().toISOString()}],q=[{id:"1",name:"Notebook Dell XPS 15",sku:"HW-DELL-XPS15",category_id:"1",qty_available:5,qty_reserved:1,min_stock:2,purchase_price:1800,sale_price:2400,notes:"High-end notebook pre vývojárov",created_at:new Date().toISOString(),updated_at:new Date().toISOString(),category:{id:"1",name:"Hardware",created_at:new Date().toISOString()}},{id:"2",name:"Monitor Dell UltraSharp U2723QE",sku:"HW-DELL-U2723QE",category_id:"1",qty_available:12,qty_reserved:0,min_stock:5,purchase_price:450,sale_price:650,notes:"4K USB-C Hub Monitor",created_at:new Date().toISOString(),updated_at:new Date().toISOString(),category:{id:"1",name:"Hardware",created_at:new Date().toISOString()}},{id:"3",name:"Office 365 Business Standard",sku:"SW-O365-BUS",category_id:"2",qty_available:100,qty_reserved:0,min_stock:10,purchase_price:10,sale_price:12.5,notes:"Mesačná licencia",created_at:new Date().toISOString(),updated_at:new Date().toISOString(),category:{id:"2",name:"Software",created_at:new Date().toISOString()}},{id:"4",name:"Inštalácia Windowsu",sku:"SRV-WIN-INSTALL",category_id:"3",qty_available:999,qty_reserved:0,min_stock:0,purchase_price:0,sale_price:50,notes:"Služba inštalácie OS",created_at:new Date().toISOString(),updated_at:new Date().toISOString(),category:{id:"3",name:"Služby",created_at:new Date().toISOString()}}];function I(){const{isDemo:e}=v();return m({queryKey:["inventory-categories",e],queryFn:async()=>{if(e)return f;const{data:t,error:n}=await i.from("inventory_categories").select("*").order("name");if(n)throw n;return t}})}function p(e){const{user:t,isDemo:n}=v();return m({queryKey:["inventory",e,n],queryFn:async()=>{if(n){let a=[...q];if(e?.categoryId&&(a=a.filter(s=>s.category_id===e.categoryId)),e?.search){const s=e.search.toLowerCase();a=a.filter(y=>y.name.toLowerCase().includes(s)||y.sku.toLowerCase().includes(s))}return e?.lowStock&&(a=a.filter(s=>s.qty_available-s.qty_reserved<s.min_stock)),a}let r=i.from("inventory_items").select(`
          *,
          category:inventory_categories(id, name)
        `).order("name");e?.categoryId&&(r=r.eq("category_id",e.categoryId)),e?.search&&(r=r.or(`name.ilike.%${e.search}%,sku.ilike.%${e.search}%`));const{data:c,error:d}=await r;if(d)throw d;let u=c;return e?.lowStock&&(u=u.filter(a=>a.qty_available-a.qty_reserved<a.min_stock)),u},enabled:!!t})}function h(){const e=_();return l({mutationFn:async t=>{const{data:n,error:r}=await i.from("inventory_items").insert({name:t.name,sku:t.sku,category_id:t.category_id,qty_available:t.qty_available||0,qty_reserved:0,min_stock:t.min_stock||0,purchase_price:t.purchase_price,sale_price:t.sale_price,notes:t.notes}).select().single();if(r)throw r;return n},onSuccess:()=>{e.invalidateQueries({queryKey:["inventory"]})}})}function b(){const e=_();return l({mutationFn:async({id:t,...n})=>{const{data:r,error:c}=await i.from("inventory_items").update({...n,updated_at:new Date().toISOString()}).eq("id",t).select().single();if(c)throw c;return r},onSuccess:t=>{e.invalidateQueries({queryKey:["inventory"]}),e.invalidateQueries({queryKey:["inventory",t.id]})}})}function k(){const e=_();return l({mutationFn:async({id:t,forceDelete:n=!1})=>{const{data:r,error:c}=await i.from("quote_items").select("id, quote:quotes(quote_number)").eq("inventory_item_id",t);if(c)throw c;const d=r?.map(o=>o.quote?.quote_number).filter(Boolean)||[],{data:u,error:a}=await i.from("invoice_items").select("id, invoice:invoices(invoice_number)").eq("inventory_item_id",t);if(a)throw a;const s=u?.map(o=>o.invoice?.invoice_number).filter(Boolean)||[];if((d.length>0||s.length>0)&&!n){const o=new Error("Item has references");throw o.affectedQuotes=d,o.affectedInvoices=s,o}if(n){if(r&&r.length>0){const{error:o}=await i.from("quote_items").delete().eq("inventory_item_id",t);if(o)throw o}if(u&&u.length>0){const{error:o}=await i.from("invoice_items").delete().eq("inventory_item_id",t);if(o)throw o}}const{error:y}=await i.from("inventory_items").delete().eq("id",t);if(y)throw y},onSuccess:()=>{e.invalidateQueries({queryKey:["inventory"]}),e.invalidateQueries({queryKey:["quotes"]}),e.invalidateQueries({queryKey:["invoices"]})}})}function D(){const e=_();return l({mutationFn:async({itemId:t,adjustment:n})=>{const{data:r,error:c}=await i.from("inventory_items").select("qty_available").eq("id",t).single();if(c)throw c;const d=Math.max(0,(r.qty_available||0)+n),{data:u,error:a}=await i.from("inventory_items").update({qty_available:d,updated_at:new Date().toISOString()}).eq("id",t).select().single();if(a)throw a;return u},onSuccess:()=>{e.invalidateQueries({queryKey:["inventory"]})}})}function O(e){const{isDemo:t}=v();return m({queryKey:["inventory-reservations",e,t],queryFn:async()=>{if(t)return[];const{data:n,error:r}=await i.from("reservations").select(`
          *,
          client:clients(id, contact_name, company_name),
          quote:quotes(id, quote_number)
        `).eq("inventory_item_id",e).order("created_at",{ascending:!1});if(r)throw r;return n},enabled:!!e})}export{h as a,I as b,b as c,O as d,D as e,k as f,p as u};
