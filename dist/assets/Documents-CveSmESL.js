import{c as b,u as R,o as P,s as M,r as u,j as e,B as N,X as je,n as B,t as j,g as T,S as I,C as ee,b as ae}from"./index-lYTtkRVl.js";import{u as U,D as Z,e as Q,f as X,g as G,h as H,F as J,i as de,B as W,U as ve,x as Ne,b as _e,S as we,y as se}from"./AppLayout-vg_1wxoQ.js";import{L,I as me,S as ue,a as he,b as pe,c as xe,d as K}from"./select-CrR1bKbv.js";import{u as be,D as ke,a as De,b as Se,c as A}from"./ThemeToggle-H5MkW5aa.js";import{D as ge}from"./download-CvHdGBtJ.js";import{C as te}from"./checkbox-xBRoLJhd.js";import{T as Ce,a as ze,b as le,c as re}from"./tabs-CZyMT0Oi.js";import{a as Me}from"./useSalespeople-CqvGwKPM.js";import{A as Fe,a as Oe,b as Ie,c as Ae,d as Te,e as Le,f as Pe,g as Ue}from"./alert-dialog-CJEM0QG8.js";import{P as ne,E as Ee}from"./plus-DrMUNdvj.js";import{E as Ve}from"./eye-DVQLVt6d.js";import{T as $e}from"./trash-2-DkyHMLmO.js";const Be=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 12.5 8 15l2 2.5",key:"1tg20x"}],["path",{d:"m14 12.5 2 2.5-2 2.5",key:"yinavb"}]],Ke=b("file-code",Be);const qe=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["circle",{cx:"10",cy:"12",r:"2",key:"737tya"}],["path",{d:"m20 17-1.296-1.296a2.41 2.41 0 0 0-3.408 0L9 22",key:"wt3hpn"}]],V=b("file-image",qe);const Re=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M8 13h2",key:"yr2amv"}],["path",{d:"M14 13h2",key:"un5t4a"}],["path",{d:"M8 17h2",key:"2yhykz"}],["path",{d:"M14 17h2",key:"10kma7"}]],$=b("file-spreadsheet",Re);const Ze=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}]],q=b("file",Ze);const Qe=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M7 3v18",key:"bbkbws"}],["path",{d:"M3 7.5h4",key:"zfgn84"}],["path",{d:"M3 12h18",key:"1i2n21"}],["path",{d:"M3 16.5h4",key:"1230mu"}],["path",{d:"M17 3v18",key:"in4fa5"}],["path",{d:"M17 7.5h4",key:"myr1c1"}],["path",{d:"M17 16.5h4",key:"go4c1d"}]],Xe=b("film",Qe);const Ge=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"m21 3-7 7",key:"1l2asr"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M9 21H3v-6",key:"wtvkvv"}]],He=b("maximize-2",Ge);const Je=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]],fe=b("shield",Je);const We=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],ie=b("upload",We),Ye=[{id:"1",title:"Cenník služieb 2024",category:"pricelist",file_url:"#",file_type:"application/pdf",file_size:"2.4 MB",allowed_roles:["admin","manager","sales"],allowed_user_ids:[],created_by:"1",created_at:new Date().toISOString(),created_by_user:{id:"1",full_name:"Ján Novák",email:"jan@example.com",phone:null,avatar_url:null,region_id:null,theme_preference:"system",is_active:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}},{id:"2",title:"Marketingová prezentácia Q1",category:"marketing",file_url:"#",file_type:"application/vnd.openxmlformats-officedocument.presentationml.presentation",file_size:"15.7 MB",allowed_roles:["admin","manager","sales"],allowed_user_ids:[],created_by:"1",created_at:new Date(Date.now()-864e5).toISOString(),created_by_user:{id:"1",full_name:"Ján Novák",email:"jan@example.com",phone:null,avatar_url:null,region_id:null,theme_preference:"system",is_active:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}},{id:"3",title:"Interné smernice BOZP",category:"internal",file_url:"#",file_type:"application/pdf",file_size:"1.1 MB",allowed_roles:["admin","manager"],allowed_user_ids:[],created_by:"2",created_at:new Date(Date.now()-1728e5).toISOString(),created_by_user:{id:"2",full_name:"Mária Kováčová",email:"maria@example.com",phone:null,avatar_url:null,region_id:null,theme_preference:"system",is_active:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}},{id:"4",title:"Vzorová zmluva o dielo",category:"legal",file_url:"#",file_type:"application/msword",file_size:"540 KB",allowed_roles:["admin","manager"],allowed_user_ids:[],created_by:"1",created_at:new Date(Date.now()-2592e5).toISOString(),created_by_user:{id:"1",full_name:"Ján Novák",email:"jan@example.com",phone:null,avatar_url:null,region_id:null,theme_preference:"system",is_active:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}},{id:"5",title:"Produktový katalóg 2024",category:"marketing",file_url:"#",file_type:"application/pdf",file_size:"45.2 MB",allowed_roles:["admin","manager","sales"],allowed_user_ids:[],created_by:"2",created_at:new Date(Date.now()-3456e5).toISOString(),created_by_user:{id:"2",full_name:"Mária Kováčová",email:"maria@example.com",phone:null,avatar_url:null,region_id:null,theme_preference:"system",is_active:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}}];function ea(a){const{user:l}=R(),t=l?.email==="demo@artstone.sk"||l?.email==="obchod@artstone.sk"||l?.email==="manazer@artstone.sk";return be({queryKey:["documents",a,t],queryFn:async()=>{let r=[];if(t)r=[...Ye];else{console.log("Fetching documents from Supabase...");let n=M.from("documents").select("*").order("created_at",{ascending:!1});a?.category&&(n=n.eq("category",a.category)),a?.search&&(n=n.ilike("title",`%${a.search}%`));const{data:d,error:m}=await n;if(m)throw console.error("Error fetching documents:",m),m;const{data:g}=await M.from("profiles").select("id, full_name, email"),f=new Map(g?.map(c=>[c.id,c.full_name||c.email||"Neznámy"])||[]);r=(d||[]).map(c=>({...c,created_by_user:{id:c.created_by,full_name:f.get(c.created_by)||"Neznámy používateľ",email:"",phone:null,avatar_url:null,region_id:null,theme_preference:"system",is_active:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}}))}return console.log("=== RETURNING ALL DATA (no filtering) ==="),console.log("Document count:",r.length),r},enabled:!!l})}function aa(){const a=P(),{user:l}=R();return U({mutationFn:async t=>{const{data:r,error:n}=await M.from("documents").insert({title:t.title,category:t.category,file_url:t.file_url,file_type:t.file_type,file_size:t.file_size,allowed_roles:t.allowed_roles||["admin","manager","sales"],allowed_user_ids:t.allowed_user_ids||[],created_by:l?.id}).select().single();if(n)throw n;return r},onSuccess:()=>{a.invalidateQueries({queryKey:["documents"]})}})}function sa(){const a=P();return U({mutationFn:async({id:l,...t})=>{const{data:r,error:n}=await M.from("documents").update(t).eq("id",l).select().single();if(n)throw n;return r},onSuccess:l=>{a.invalidateQueries({queryKey:["documents"]}),a.invalidateQueries({queryKey:["documents",l.id]})}})}function ta(){const a=P();return U({mutationFn:async l=>{const{error:t}=await M.from("documents").delete().eq("id",l);if(t)throw t},onSuccess:()=>{a.invalidateQueries({queryKey:["documents"]})}})}function la(){return P(),U({mutationFn:async a=>{const l=a.name.split(".").pop(),r=`documents/${`${Date.now()}-${Math.random().toString(36).substring(7)}.${l}`}`,{error:n}=await M.storage.from("documents").upload(r,a);if(n)throw n;const{data:{publicUrl:d}}=M.storage.from("documents").getPublicUrl(r);return{url:d,fileName:a.name,fileType:l||"unknown",fileSize:ra(a.size)}}})}function ra(a){if(a===0)return"0 Bytes";const l=1024,t=["Bytes","KB","MB","GB"],r=Math.floor(Math.log(a)/Math.log(l));return parseFloat((a/Math.pow(l,r)).toFixed(2))+" "+t[r]}const na={pricelist:"Cenníky",manual:"Návody",internal:"Interné postupy",marketing:"Marketing",legal:"Právne"},ia=["application/pdf","image/png","image/jpeg","text/plain","video/mp4","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","text/csv"],oa=".pdf,.png,.jpg,.jpeg,.txt,.mp4,.doc,.docx,.csv",ca=50*1024*1024;function da({open:a,onOpenChange:l}){const[t,r]=u.useState(null),[n,d]=u.useState(""),[m,g]=u.useState("marketing"),[f,c]=u.useState(!1),_=la(),v=aa(),y=_.isPending||v.isPending,k=o=>{if(!ia.includes(o.type)){j.error("Nepodporovaný typ súboru. Povolené typy: PDF, PNG, JPG, TXT, MP4, DOC, DOCX, CSV");return}if(o.size>ca){j.error("Súbor je príliš veľký. Maximálna veľkosť je 50MB");return}r(o),n||d(o.name.replace(/\.[^/.]+$/,""))},O=o=>{const w=o.target.files?.[0];w&&k(w)},s=o=>{o.preventDefault(),c(!0)},h=()=>{c(!1)},D=o=>{o.preventDefault(),c(!1);const w=o.dataTransfer.files?.[0];w&&k(w)},F=async()=>{if(!t||!n){j.error("Prosím vyplňte všetky polia");return}try{const o=await _.mutateAsync(t);await v.mutateAsync({title:n,category:m,file_url:o.url,file_type:t.type,file_size:o.fileSize}),j.success("Dokument úspešne nahraný"),S()}catch(o){console.error("Upload error:",o),j.error(o?.message||"Nepodarilo sa nahrať dokument")}},S=()=>{r(null),d(""),g("marketing"),l(!1)},E=()=>{r(null)};return e.jsx(Z,{open:a,onOpenChange:S,children:e.jsxs(Q,{className:"sm:max-w-[500px]",children:[e.jsxs(X,{children:[e.jsx(G,{children:"Nahrať dokument"}),e.jsx(H,{children:"Nahrajte PDF, obrázky, text, video, Word dokumenty alebo CSV súbory"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[t?e.jsx("div",{className:"border rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(J,{className:"h-8 w-8 text-primary"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:t.name}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[(t.size/1024/1024).toFixed(2)," MB"]})]})]}),e.jsx(N,{variant:"ghost",size:"icon-sm",onClick:E,disabled:y,children:e.jsx(je,{className:"h-4 w-4"})})]})}):e.jsxs("div",{onDragOver:s,onDragLeave:h,onDrop:D,className:`
                relative border-2 border-dashed rounded-lg p-8
                ${f?"border-primary bg-primary/5":"border-border"}
                transition-colors cursor-pointer hover:border-primary/50
              `,children:[e.jsx("input",{type:"file",onChange:O,accept:oa,className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer"}),e.jsxs("div",{className:"flex flex-col items-center gap-2 text-center",children:[e.jsx(ie,{className:"h-10 w-10 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Kliknite alebo pretiahnite súbor"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"PDF, PNG, JPG, TXT, MP4, DOC, DOCX, CSV (max 50MB)"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"title",children:"Názov dokumentu *"}),e.jsx(me,{id:"title",value:n,onChange:o=>d(o.target.value),placeholder:"Zadajte názov dokumentu",disabled:y})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"category",children:"Kategória *"}),e.jsxs(ue,{value:m,onValueChange:o=>g(o),disabled:y,children:[e.jsx(he,{id:"category",children:e.jsx(pe,{})}),e.jsx(xe,{children:Object.entries(na).map(([o,w])=>e.jsx(K,{value:o,children:w},o))})]})]})]}),e.jsxs(de,{children:[e.jsx(N,{variant:"outline",onClick:S,disabled:y,children:"Zrušiť"}),e.jsx(N,{onClick:F,disabled:!t||!n||y,children:y?e.jsxs(e.Fragment,{children:[e.jsx(B,{className:"mr-2 h-4 w-4 animate-spin"}),"Nahrávam..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ie,{className:"mr-2 h-4 w-4"}),"Nahrať"]})})]})]})})}const ma={pricelist:"Cenníky",manual:"Návody",internal:"Interné postupy",marketing:"Marketing",legal:"Právne"};function ua({document:a,open:l,onOpenChange:t,onDownload:r}){const[n,d]=u.useState(!1),m=a?.file_type?.split("/").pop()||"file",g=m==="pdf"||a?.file_type==="application/pdf",f=["png","jpg","jpeg","gif","webp","image/png","image/jpeg","image/jpg","image/gif","image/webp"].includes(m.toLowerCase())||a?.file_type?.startsWith("image/"),c=g||f,_=()=>{r&&a&&r(a)},v=()=>{d(!n)};return a?e.jsx(Z,{open:l,onOpenChange:t,children:e.jsxs(Q,{className:T("max-h-[90vh] overflow-y-auto",n?"max-w-[95vw] w-[95vw]":"max-w-[850px] w-full"),children:[e.jsx(X,{children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(G,{className:"text-2xl",children:a.title}),e.jsx(H,{className:"mt-2",children:a.description||"Žiadny popis"})]}),e.jsxs("div",{className:"flex gap-2 shrink-0",children:[c&&e.jsxs(N,{variant:"outline",size:"sm",onClick:v,children:[e.jsx(He,{className:"h-4 w-4 mr-2"}),n?"Zmenšiť":"Zväčšiť"]}),e.jsxs(N,{variant:"outline",size:"sm",onClick:_,children:[e.jsx(ge,{className:"h-4 w-4 mr-2"}),"Stiahnuť"]})]})]})}),e.jsxs("div",{className:"space-y-6 mt-4 overflow-y-auto",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Kategória"}),e.jsx(W,{variant:"secondary",children:ma[a.category]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Typ súboru"}),e.jsx("p",{className:"font-medium",children:m.toUpperCase()})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Veľkosť"}),e.jsx("p",{className:"font-medium",children:a.file_size||"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Nahral"}),e.jsx("p",{className:"font-medium",children:a.created_by_user?.full_name||"Neznámy"})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Vytvorené"}),e.jsx("p",{className:"font-medium",children:new Date(a.created_at).toLocaleString("sk-SK",{dateStyle:"medium",timeStyle:"short"})})]}),c&&e.jsxs("div",{className:"border rounded-lg overflow-hidden bg-muted/30",children:[e.jsx("div",{className:"p-3 bg-muted/50 border-b flex items-center justify-between",children:e.jsx("p",{className:"text-sm font-medium",children:"Náhľad"})}),e.jsxs("div",{className:"bg-white dark:bg-gray-900 overflow-auto",style:{height:n?"calc(90vh - 300px)":"500px",width:"100%"},children:[g&&e.jsx("iframe",{src:a.file_url,className:"w-full h-full border-0",title:a.title}),f&&e.jsx("img",{src:a.file_url,alt:a.title,className:"w-full h-auto",style:{display:"block"}})]})]}),!c&&e.jsxs("div",{className:"border rounded-lg p-8 text-center bg-muted/30",children:[e.jsx(J,{className:"h-12 w-12 mx-auto mb-4 text-muted-foreground"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Náhľad nie je k dispozícii pre tento typ súboru.",e.jsx("br",{}),"Stiahnite dokument pre zobrazenie."]})]})]})]})}):null}const oe=[{id:"admin",label:"Admin"},{id:"manager",label:"Manažér"},{id:"sales",label:"Obchodník"}];function ha({document:a,open:l,onOpenChange:t}){const{data:r,isLoading:n}=Me(),d=sa(),[m,g]=u.useState([]),[f,c]=u.useState([]),[_,v]=u.useState("roles");u.useEffect(()=>{a&&l&&(g(a.allowed_roles||[]),c(a.allowed_user_ids||[]),a.allowed_user_ids&&a.allowed_user_ids.length>0?v("users"):v("roles"))},[a,l]);const y=async()=>{if(a)try{await d.mutateAsync({id:a.id,allowed_roles:m,allowed_user_ids:f}),j.success("Prístup k dokumentu bol aktualizovaný"),t(!1)}catch(s){j.error("Nepodarilo sa aktualizovať prístup"),console.error(s)}},k=s=>{g(h=>h.includes(s)?h.filter(D=>D!==s):[...h,s])},O=s=>{c(h=>h.includes(s)?h.filter(D=>D!==s):[...h,s])};return a?e.jsx(Z,{open:l,onOpenChange:t,children:e.jsxs(Q,{className:"max-w-md",children:[e.jsxs(X,{children:[e.jsx(G,{children:"Upraviť prístup"}),e.jsxs(H,{children:['Nastavte, kto môže vidieť dokument "',a.title,'".']})]}),e.jsxs(Ce,{value:_,onValueChange:s=>v(s),className:"w-full",children:[e.jsxs(ze,{className:"grid w-full grid-cols-2",children:[e.jsxs(le,{value:"roles",className:"flex items-center gap-2",children:[e.jsx(fe,{className:"h-4 w-4"}),"Podľa rolí"]}),e.jsxs(le,{value:"users",className:"flex items-center gap-2",children:[e.jsx(ve,{className:"h-4 w-4"}),"Konkrétni ľudia"]})]}),e.jsxs("div",{className:"mt-4 min-h-[300px]",children:[e.jsxs(re,{value:"roles",className:"space-y-4",children:[e.jsx("div",{className:"text-sm text-muted-foreground mb-4",children:"Vyberte roly, ktoré budú mať prístup k tomuto dokumentu. Admini majú prístup vždy."}),e.jsx("div",{className:"space-y-2",children:oe.map(s=>e.jsxs("div",{className:T("flex items-center space-x-3 p-3 border rounded-lg transition-colors",s.id==="admin"?"bg-muted/50 opacity-70":"hover:bg-muted/50"),children:[e.jsx(te,{id:`role-${s.id}`,checked:s.id==="admin"?!0:m.includes(s.id),onCheckedChange:()=>s.id!=="admin"&&k(s.id),disabled:s.id==="admin"}),e.jsx(L,{htmlFor:`role-${s.id}`,className:T("flex-1 font-medium",s.id==="admin"?"cursor-not-allowed line-through text-muted-foreground":"cursor-pointer"),children:s.label}),s.id==="admin"&&e.jsx(W,{variant:"outline",className:"text-xs bg-muted text-muted-foreground border-muted-foreground/30",children:"Admin"})]},s.id))})]}),e.jsxs(re,{value:"users",children:[e.jsx("div",{className:"text-sm text-muted-foreground mb-4",children:"Vyberte konkrétnych používateľov, ktorí uvidia tento dokument bez ohľadu na ich rolu."}),n?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(B,{className:"h-6 w-6 animate-spin text-muted-foreground"})}):e.jsx(Ne,{className:"h-[300px] pr-4",children:e.jsx("div",{className:"space-y-2",children:r?.map(s=>e.jsxs("div",{className:"flex items-center space-x-3 p-3 border rounded-lg hover:bg-muted/50 transition-colors",children:[e.jsx(te,{id:`user-${s.id}`,checked:f.includes(s.id),onCheckedChange:()=>O(s.id)}),e.jsxs("div",{className:"flex flex-col flex-1",children:[e.jsx(L,{htmlFor:`user-${s.id}`,className:"cursor-pointer font-medium",children:s.full_name||"Neznámy používateľ"}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[s.email," • ",oe.find(h=>h.id===s.role)?.label||s.role]})]})]},s.id))})})]})]})]}),e.jsxs(de,{className:"mt-6",children:[e.jsx(N,{variant:"outline",onClick:()=>t(!1),children:"Zrušiť"}),e.jsxs(N,{onClick:y,disabled:d.isPending,children:[d.isPending&&e.jsx(B,{className:"mr-2 h-4 w-4 animate-spin"}),"Uložiť zmeny"]})]})]})}):null}function pa({open:a,onOpenChange:l,onConfirm:t,documentTitle:r}){return e.jsx(Fe,{open:a,onOpenChange:l,children:e.jsxs(Oe,{children:[e.jsxs(Ie,{children:[e.jsx(Ae,{children:"Vymazať dokument?"}),e.jsxs(Te,{children:["Naozaj chcete vymazať dokument ",e.jsxs("strong",{children:['"',r,'"']}),"?",e.jsx("br",{}),"Táto akcia sa nedá vrátiť späť."]})]}),e.jsxs(Le,{children:[e.jsx(Pe,{children:"Zrušiť"}),e.jsx(Ue,{onClick:t,className:"bg-destructive hover:bg-destructive/90",children:"Vymazať"})]})]})})}const ce={pricelist:"Cenníky",manual:"Návody",internal:"Interné postupy",marketing:"Marketing",legal:"Právne"},xa={pricelist:"bg-primary/15 text-primary",manual:"bg-info/15 text-info",internal:"bg-warning/15 text-warning",marketing:"bg-success/15 text-success",legal:"bg-status-contacted/15 text-status-contacted"},ga={pdf:J,xlsx:$,xls:$,csv:$,docx:q,doc:q,png:V,jpg:V,jpeg:V,txt:Ke,mp4:Xe};function za(){const{user:a}=R(),[l,t]=u.useState(""),[r,n]=u.useState("all"),[d,m]=u.useState(null),[g,f]=u.useState(!1),[c,_]=u.useState(!1),[v,y]=u.useState(!1),{data:k,isLoading:O}=ea({category:r!=="all"?r:void 0,search:l||void 0}),s=ta(),h=a?.role==="admin",D=k?.reduce((i,p)=>(i[p.category]||(i[p.category]=[]),i[p.category].push(p),i),{})||{},[F,S]=u.useState(null),E=i=>{S(i)},o=async()=>{if(F)try{await s.mutateAsync(F.id),j.success("Dokument vymazaný"),S(null)}catch{j.error("Nepodarilo sa vymazať dokument")}},w=i=>{m(i),f(!0)},ye=i=>{m(i),_(!0)},Y=async i=>{if(!i.file_url){j.error("URL súboru nie je k dispozícii");return}try{const x=await(await fetch(i.file_url)).blob(),C=window.URL.createObjectURL(x),z=document.createElement("a");z.href=C,z.download=i.title+"."+(i.file_type?.split("/").pop()||"file"),document.body.appendChild(z),z.click(),document.body.removeChild(z),window.URL.revokeObjectURL(C),j.success("Sťahovanie spustené")}catch(p){console.error("Download error:",p),j.error("Nepodarilo sa stiahnuť súbor")}};return e.jsxs(_e,{title:"Dokumenty",children:[e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-between",children:[e.jsxs("div",{className:"flex flex-1 gap-3",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(we,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(me,{placeholder:"Hľadať dokumenty...",value:l,onChange:i=>t(i.target.value),className:"pl-9"})]}),e.jsxs(ue,{value:r,onValueChange:n,children:[e.jsx(he,{className:"w-44",children:e.jsx(pe,{placeholder:"Kategória"})}),e.jsxs(xe,{children:[e.jsx(K,{value:"all",children:"Všetky kategórie"}),Object.entries(ce).map(([i,p])=>e.jsx(K,{value:i,children:p},i))]})]})]}),(h||a?.role==="manager")&&e.jsxs(e.Fragment,{children:[e.jsx(N,{onClick:()=>y(!0),className:"md:hidden min-h-[44px] min-w-[44px]",size:"icon",title:"Nahrať dokument",children:e.jsx(ne,{className:"h-4 w-4"})}),e.jsxs(N,{onClick:()=>y(!0),className:"hidden md:flex",children:[e.jsx(ne,{className:"h-4 w-4 mr-2"}),"Nahrať dokument"]})]})]}),O?e.jsx("div",{className:"space-y-6",children:Array.from({length:2}).map((i,p)=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(I,{className:"h-5 w-5"}),e.jsx(I,{className:"h-6 w-32"})]}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:Array.from({length:3}).map((x,C)=>e.jsx(ee,{className:"shadow-soft",children:e.jsx(ae,{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx(I,{className:"w-12 h-12 rounded-xl"}),e.jsxs("div",{className:"flex-1",children:[e.jsx(I,{className:"h-5 w-full mb-2"}),e.jsx(I,{className:"h-4 w-24"})]})]})})},C))})]},p))}):e.jsxs(e.Fragment,{children:[Object.entries(D).map(([i,p])=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(se,{className:"h-5 w-5 text-muted-foreground"}),e.jsx("h2",{className:"font-display text-lg font-semibold",children:ce[i]}),e.jsx(W,{variant:"secondary",className:"text-xs",children:p.length})]}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:p.map(x=>{const C=x.file_type?.split("/").pop()||"file",z=ga[C]||q;return e.jsx(ee,{className:"shadow-soft hover:shadow-md transition-all duration-200 cursor-pointer group",children:e.jsx(ae,{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:T("p-3 rounded-xl",xa[x.category]),children:e.jsx(z,{className:"h-6 w-6"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-foreground truncate",children:x.title}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:[C.toUpperCase()," • ",x.file_size||"-"]})]}),e.jsxs(ke,{children:[e.jsx(De,{asChild:!0,children:e.jsx(N,{variant:"ghost",size:"icon-sm",className:"opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(Ee,{className:"h-4 w-4"})})}),e.jsxs(Se,{align:"end",children:[e.jsxs(A,{onClick:()=>w(x),children:[e.jsx(Ve,{className:"h-4 w-4 mr-2"}),"Zobraziť"]}),e.jsxs(A,{onClick:()=>Y(x),children:[e.jsx(ge,{className:"h-4 w-4 mr-2"}),"Stiahnuť"]}),(h||a?.role==="manager")&&e.jsxs(A,{onClick:()=>ye(x),children:[e.jsx(fe,{className:"h-4 w-4 mr-2"}),"Upraviť prístup"]}),(h||a?.role==="manager")&&e.jsxs(A,{className:"text-destructive",onClick:()=>E(x),children:[e.jsx($e,{className:"h-4 w-4 mr-2"}),"Vymazať"]})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between mt-3 pt-3 border-t border-border",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:x.created_by_user?.full_name||"Neznámy"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:new Date(x.created_at).toLocaleDateString("sk-SK")})]})]})]})})},x.id)})})]},i)),k?.length===0&&e.jsx(EmptyState,{icon:e.jsx(se,{className:"h-full w-full"}),title:"Zatiaľ žiadne dokumenty",description:"Nahrajte dokumenty, zmluvy alebo prílohy pre lepšiu organizáciu.",action:{label:"Nahrať dokument",onClick:()=>fileInputRef.current?.click(),icon:e.jsx(Upload,{className:"h-4 w-4"})}})]})]}),e.jsx(da,{open:v,onOpenChange:y}),e.jsx(ua,{document:d,open:g,onOpenChange:f,onDownload:Y}),e.jsx(ha,{document:d,open:c,onOpenChange:_}),e.jsx(pa,{open:!!F,onOpenChange:i=>!i&&S(null),onConfirm:o,documentTitle:F?.title||""})]})}export{za as default};
