import{c as ne,r as v,j as e,B as f,n as $,t as j,S as h,T as O,u as we,C as P,b as q,s as ae}from"./index-ixxTEzIM.js";import{D as V,d as te,e as R,f as U,g as K,i as Q,v as H,B as le,h as Ce,F as Se,R as ze,w as Ie,b as De,S as Pe}from"./AppLayout-BqQJj8es.js";import{L as x,I as N,S as G,a as J,b as W,c as X,d as T}from"./select-COUMOr2z.js";import{a as qe,b as Y,c as Fe,d as Ae,e as ce,u as Te,f as Me}from"./useInventory-DcHlp9F-.js";import{T as ie}from"./textarea-6nmU1y0a.js";import{P as M,E as Ve}from"./plus-_0AWnC6U.js";import{T as oe,a as de,b as w,c as y,d as me,e as c}from"./table-8lq7_8Yr.js";import{A as Re,a as Ue,b as Ke,c as Ee,d as re,e as Le,f as Be,g as Ze}from"./alert-dialog-BW1F7431.js";import{C as Oe}from"./checkbox-YrD5Xqf3.js";import{D as He,a as $e,b as Qe,c as A}from"./ThemeToggle-mam2t0E5.js";import{P as Ge}from"./progress-DkImKjiW.js";import{T as Je}from"./trash-2-BweOqF1V.js";const We=[["path",{d:"M5 12h14",key:"1ays0h"}]],Xe=ne("minus",We);const Ye=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]],es=ne("square-pen",Ye);function ss(){const[l,u]=v.useState(!1),[r,t]=v.useState({name:"",sku:"",category_id:"",qty_available:"",min_stock:"",purchase_price:"",sale_price:"",notes:""}),i=qe(),{data:o=[]}=Y(),p=async s=>{if(s.preventDefault(),!r.name){j.error("Názov položky je povinný");return}if(!r.sku){j.error("SKU je povinné");return}try{await i.mutateAsync({name:r.name,sku:r.sku,category_id:r.category_id||null,qty_available:r.qty_available?parseInt(r.qty_available,10):0,min_stock:r.min_stock?parseInt(r.min_stock,10):0,purchase_price:r.purchase_price?parseFloat(r.purchase_price):null,sale_price:r.sale_price?parseFloat(r.sale_price):null,notes:r.notes||null}),j.success("Položka bola úspešne vytvorená"),u(!1),t({name:"",sku:"",category_id:"",qty_available:"",min_stock:"",purchase_price:"",sale_price:"",notes:""})}catch(n){console.error("Create inventory item error:",n),j.error(n.message||"Nepodarilo sa vytvoriť položku"),n.details&&j.error(n.details)}};return e.jsxs(V,{open:l,onOpenChange:u,children:[e.jsx(te,{asChild:!0,children:e.jsx(f,{className:"md:hidden min-h-[44px] min-w-[44px]",size:"icon",title:"Pridať položku",children:e.jsx(M,{className:"h-4 w-4"})})}),e.jsx(te,{asChild:!0,children:e.jsxs(f,{className:"hidden md:flex",children:[e.jsx(M,{className:"h-4 w-4 mr-2"}),"Pridať položku"]})}),e.jsxs(R,{className:"max-w-[95vw] sm:max-w-[600px]",children:[e.jsx(U,{children:e.jsx(K,{children:"Vytvoriť novú položku"})}),e.jsxs("form",{onSubmit:p,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"name",children:"Názov *"}),e.jsx(N,{id:"name",placeholder:"Brúsený kameň",value:r.name,onChange:s=>t({...r,name:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"sku",children:"SKU *"}),e.jsx(N,{id:"sku",placeholder:"BRT-001",value:r.sku,onChange:s=>t({...r,sku:s.target.value})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"category",children:"Kategória"}),e.jsxs(G,{value:r.category_id,onValueChange:s=>t({...r,category_id:s}),children:[e.jsx(J,{children:e.jsx(W,{placeholder:"Vyberte kategóriu"})}),e.jsx(X,{children:o.map(s=>e.jsx(T,{value:s.id,children:s.name},s.id))})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"qty_available",children:"Počiatočné množstvo (ks)"}),e.jsx(N,{id:"qty_available",type:"number",min:"0",placeholder:"0",value:r.qty_available,onChange:s=>t({...r,qty_available:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"min_stock",children:"Minimálne zásoby (ks)"}),e.jsx(N,{id:"min_stock",type:"number",min:"0",placeholder:"0",value:r.min_stock,onChange:s=>t({...r,min_stock:s.target.value})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"purchase_price",children:"Nákupná cena (€)"}),e.jsx(N,{id:"purchase_price",type:"number",step:"0.01",min:"0",placeholder:"0.00",value:r.purchase_price,onChange:s=>t({...r,purchase_price:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"sale_price",children:"Predajná cena (€)"}),e.jsx(N,{id:"sale_price",type:"number",step:"0.01",min:"0",placeholder:"0.00",value:r.sale_price,onChange:s=>t({...r,sale_price:s.target.value})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"notes",children:"Poznámka"}),e.jsx(ie,{id:"notes",placeholder:"Interné poznámky...",value:r.notes,onChange:s=>t({...r,notes:s.target.value})})]}),e.jsxs(Q,{children:[e.jsx(f,{type:"button",variant:"outline",onClick:()=>u(!1),disabled:i.isPending,children:"Zrušiť"}),e.jsx(f,{type:"submit",disabled:i.isPending,children:i.isPending?e.jsxs(e.Fragment,{children:[e.jsx($,{className:"mr-2 h-4 w-4 animate-spin"}),"Vytváram..."]}):"Vytvoriť položku"})]})]})]})]})}function as({item:l,open:u,onOpenChange:r}){const[t,i]=v.useState({name:"",sku:"",category_id:"",min_stock:"",purchase_price:"",sale_price:"",notes:""}),o=Fe(),{data:p=[]}=Y();v.useEffect(()=>{l&&i({name:l.name,sku:l.sku,category_id:l.category_id||"",min_stock:l.min_stock?.toString()||"",purchase_price:l.purchase_price?.toString()||"",sale_price:l.sale_price?.toString()||"",notes:l.notes||""})},[l]);const s=async n=>{if(n.preventDefault(),!!l){if(!t.name){j.error("Názov položky je povinný");return}if(!t.sku){j.error("SKU je povinné");return}try{await o.mutateAsync({id:l.id,name:t.name,sku:t.sku,category_id:t.category_id||null,min_stock:t.min_stock?parseInt(t.min_stock,10):0,purchase_price:t.purchase_price?parseFloat(t.purchase_price):null,sale_price:t.sale_price?parseFloat(t.sale_price):null,notes:t.notes||null}),j.success("Položka bola úspešne upravená"),r(!1)}catch(m){console.error("Update inventory item error:",m),j.error(m.message||"Nepodarilo sa upraviť položku"),m.details&&j.error(m.details)}}};return l?e.jsx(V,{open:u,onOpenChange:r,children:e.jsxs(R,{className:"sm:max-w-[600px]",children:[e.jsx(U,{children:e.jsx(K,{children:"Upraviť položku"})}),e.jsxs("form",{onSubmit:s,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"edit-name",children:"Názov *"}),e.jsx(N,{id:"edit-name",placeholder:"Brúsený kameň",value:t.name,onChange:n=>i({...t,name:n.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"edit-sku",children:"SKU *"}),e.jsx(N,{id:"edit-sku",placeholder:"BRT-001",value:t.sku,onChange:n=>i({...t,sku:n.target.value})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"edit-category",children:"Kategória"}),e.jsxs(G,{value:t.category_id,onValueChange:n=>i({...t,category_id:n}),children:[e.jsx(J,{children:e.jsx(W,{placeholder:"Vyberte kategóriu"})}),e.jsx(X,{children:p.map(n=>e.jsx(T,{value:n.id,children:n.name},n.id))})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{children:"Dostupné zásoby"}),e.jsxs("div",{className:"px-3 py-2 border rounded-md bg-muted text-muted-foreground",children:[l.qty_available," ks"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:'Použite "Pridať zásoby" na zmenu množstva'})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"edit-min-stock",children:"Minimálne zásoby (ks)"}),e.jsx(N,{id:"edit-min-stock",type:"number",min:"0",placeholder:"0",value:t.min_stock,onChange:n=>i({...t,min_stock:n.target.value})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"edit-purchase-price",children:"Nákupná cena (€)"}),e.jsx(N,{id:"edit-purchase-price",type:"number",step:"0.01",min:"0",placeholder:"0.00",value:t.purchase_price,onChange:n=>i({...t,purchase_price:n.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"edit-sale-price",children:"Predajná cena (€)"}),e.jsx(N,{id:"edit-sale-price",type:"number",step:"0.01",min:"0",placeholder:"0.00",value:t.sale_price,onChange:n=>i({...t,sale_price:n.target.value})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"edit-notes",children:"Poznámka"}),e.jsx(ie,{id:"edit-notes",placeholder:"Interné poznámky...",value:t.notes,onChange:n=>i({...t,notes:n.target.value})})]}),e.jsxs(Q,{children:[e.jsx(f,{type:"button",variant:"outline",onClick:()=>r(!1),disabled:o.isPending,children:"Zrušiť"}),e.jsx(f,{type:"submit",disabled:o.isPending,children:o.isPending?e.jsxs(e.Fragment,{children:[e.jsx($,{className:"mr-2 h-4 w-4 animate-spin"}),"Ukladám..."]}):"Uložiť zmeny"})]})]})]})}):null}function ts({item:l,open:u,onOpenChange:r}){const{data:t,isLoading:i}=Ae(l?.id||""),o=s=>new Date(s).toLocaleDateString("sk-SK",{year:"numeric",month:"long",day:"numeric"}),p=s=>{const m={active:{label:"Aktívna",variant:"default"},fulfilled:{label:"Splnená",variant:"secondary"},cancelled:{label:"Zrušená",variant:"destructive"}}[s]||{label:s,variant:"outline"};return e.jsx(le,{variant:m.variant,children:m.label})};return l?e.jsx(V,{open:u,onOpenChange:r,children:e.jsxs(R,{className:"sm:max-w-[700px]",children:[e.jsx(U,{children:e.jsxs(K,{className:"flex items-center gap-2",children:[e.jsx(H,{className:"h-5 w-5"}),"Rezervácie: ",l.name]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-muted rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Celkovo rezervované"}),e.jsxs("p",{className:"text-2xl font-semibold",children:[l.qty_reserved," ks"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Dostupné"}),e.jsxs("p",{className:"text-2xl font-semibold",children:[l.qty_available-l.qty_reserved," ks"]})]})]}),e.jsx("div",{className:"border rounded-lg",children:e.jsxs(oe,{children:[e.jsx(de,{children:e.jsxs(w,{children:[e.jsx(y,{children:"Klient"}),e.jsx(y,{children:"Ponuka"}),e.jsx(y,{className:"text-center",children:"Množstvo"}),e.jsx(y,{children:"Stav"}),e.jsx(y,{children:"Vytvorené"})]})}),e.jsx(me,{children:i?Array.from({length:3}).map((s,n)=>e.jsxs(w,{children:[e.jsx(c,{children:e.jsx(h,{className:"h-5 w-32"})}),e.jsx(c,{children:e.jsx(h,{className:"h-5 w-24"})}),e.jsx(c,{children:e.jsx(h,{className:"h-5 w-16"})}),e.jsx(c,{children:e.jsx(h,{className:"h-5 w-20"})}),e.jsx(c,{children:e.jsx(h,{className:"h-5 w-28"})})]},n)):t?.length===0?e.jsx(w,{children:e.jsx(c,{colSpan:5,className:"text-center py-8 text-muted-foreground",children:"Žiadne rezervácie"})}):t?.map(s=>e.jsxs(w,{children:[e.jsx(c,{children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.client?.contact_name||"-"}),s.client?.company_name&&e.jsx("p",{className:"text-sm text-muted-foreground",children:s.client.company_name})]})}),e.jsx(c,{children:s.quote?e.jsx("code",{className:"text-sm bg-muted px-2 py-0.5 rounded",children:s.quote.quote_number}):"-"}),e.jsxs(c,{className:"text-center font-medium",children:[s.quantity," ks"]}),e.jsx(c,{children:p(s.status)}),e.jsx(c,{className:"text-sm text-muted-foreground",children:o(s.created_at)})]},s.id))})]})})]})]})}):null}function rs({open:l,onOpenChange:u,itemId:r,itemName:t,currentStock:i}){const[o,p]=v.useState(1),[s,n]=v.useState("add"),m=ce(),_=async()=>{if(o<=0){j.error("Množstvo musí byť väčšie ako 0");return}const b=s==="add"?o:-o;try{await m.mutateAsync({itemId:r,adjustment:b}),j.success(s==="add"?"Zásoby pridané":"Zásoby odobrané"),u(!1),p(1),n("add")}catch(z){console.error("Adjust stock error:",z),j.error("Nepodarilo sa upraviť zásoby")}},k=()=>{u(!1),p(1),n("add")};return e.jsx(V,{open:l,onOpenChange:k,children:e.jsxs(R,{className:"sm:max-w-[425px]",children:[e.jsxs(U,{children:[e.jsx(K,{children:"Upraviť zásoby"}),e.jsxs(Ce,{children:[t,e.jsx("br",{}),e.jsxs("span",{className:"text-sm",children:["Aktuálny stav: ",e.jsxs("strong",{children:[i," ks"]})]})]})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(f,{type:"button",variant:s==="add"?"default":"outline",className:"flex-1",onClick:()=>n("add"),children:[e.jsx(M,{className:"h-4 w-4 mr-2"}),"Pridať"]}),e.jsxs(f,{type:"button",variant:s==="remove"?"default":"outline",className:"flex-1",onClick:()=>n("remove"),children:[e.jsx(Xe,{className:"h-4 w-4 mr-2"}),"Odobrať"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"quantity",children:"Množstvo (ks)"}),e.jsx(N,{id:"quantity",type:"number",min:"1",value:o,onChange:b=>p(parseInt(b.target.value)||0),placeholder:"Zadajte počet kusov",autoFocus:!0})]}),e.jsxs("div",{className:"bg-muted p-3 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Nový stav:"}),e.jsxs("span",{className:"text-lg font-bold",children:[s==="add"?i+o:Math.max(0,i-o)," ks"]})]}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:[s==="add"?`+${o}`:`-${o}`," ks"]})]})]}),e.jsxs(Q,{children:[e.jsx(f,{variant:"outline",onClick:k,disabled:m.isPending,children:"Zrušiť"}),e.jsx(f,{onClick:_,disabled:m.isPending||o<=0,children:m.isPending?e.jsxs(e.Fragment,{children:[e.jsx($,{className:"mr-2 h-4 w-4 animate-spin"}),"Upravujem..."]}):s==="add"?"Pridať zásoby":"Odobrať zásoby"})]})]})})}function ns({open:l,onOpenChange:u,itemName:r,affectedQuotes:t=[],affectedInvoices:i=[],onConfirm:o,onAdjustStockInstead:p,isDeleting:s=!1}){const[n,m]=v.useState(!1),_=t.length>0||i.length>0,k=()=>{o(n),m(!1)},b=()=>{u(!1),m(!1)},z=()=>{u(!1),m(!1),p?.()};return e.jsx(Re,{open:l,onOpenChange:b,children:e.jsxs(Ue,{className:"max-w-lg",children:[e.jsxs(Ke,{children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex h-12 w-12 items-center justify-center rounded-full bg-destructive/10",children:e.jsx(O,{className:"h-6 w-6 text-destructive"})}),e.jsx(Ee,{children:"Vymazať skladovú položku"})]}),e.jsxs(re,{className:"text-left pt-4",children:["Naozaj chcete vymazať položku ",e.jsxs("strong",{className:"text-foreground",children:['"',r,'"']}),"?"]})]}),_&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"rounded-lg border border-warning bg-warning/10 p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(O,{className:"h-5 w-5 text-warning mt-0.5"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:"Položka je použitá v existujúcich dokumentoch"}),t.length>0&&e.jsxs("div",{className:"text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground mb-1",children:[e.jsx(Se,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:"Cenové ponuky:"})]}),e.jsx("div",{className:"ml-6 space-y-1",children:t.map(g=>e.jsx("div",{className:"text-foreground",children:g},g))})]}),i.length>0&&e.jsxs("div",{className:"text-sm mt-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground mb-1",children:[e.jsx(ze,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:"Faktúry:"})]}),e.jsx("div",{className:"ml-6 space-y-1",children:i.map(g=>e.jsx("div",{className:"text-foreground",children:g},g))})]})]})]})}),e.jsxs("div",{className:"flex items-start space-x-3 rounded-lg border border-destructive/50 bg-destructive/5 p-4",children:[e.jsx(Oe,{id:"force-delete",checked:n,onCheckedChange:g=>m(g===!0),disabled:s}),e.jsxs("div",{className:"grid gap-1.5 leading-none",children:[e.jsx(x,{htmlFor:"force-delete",className:"text-sm font-medium cursor-pointer text-foreground",children:"Vynútené vymazanie"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Položka bude odstránená zo všetkých cenových ponúk a faktúr. Táto akcia je nevratná a ovplyvní historické záznamy."})]})]})]}),!_&&e.jsx(re,{className:"text-left",children:"Táto akcia je nevratná a položka bude trvalo odstránená zo skladu."}),e.jsxs(Le,{className:"flex-col sm:flex-row gap-2",children:[e.jsx(Be,{disabled:s,onClick:b,children:"Zrušiť"}),_&&p&&e.jsxs(f,{variant:"outline",onClick:z,disabled:s,children:[e.jsx(Ie,{className:"h-4 w-4 mr-2"}),"Upraviť zásoby namiesto toho"]}),e.jsx(Ze,{onClick:g=>{g.preventDefault(),k()},disabled:s||_&&!n,className:"bg-destructive hover:bg-destructive/90",children:s?"Vymazávam...":"Vymazať"})]})]})})}function gs(){const{user:l}=we(),[u,r]=v.useState(""),[t,i]=v.useState("all"),[o,p]=v.useState(null),[s,n]=v.useState(null),[m,_]=v.useState(null),[k,b]=v.useState(null),[z,g]=v.useState([]),[xe,F]=v.useState([]),{data:he,isLoading:ue}=Y(),{data:C,isLoading:je}=Te({categoryId:t!=="all"?t:void 0,search:u||void 0}),ee=Me();ce();const I=l?.role==="admin",D=ue||je,se=a=>a===null?"-":new Intl.NumberFormat("sk-SK",{style:"currency",currency:"EUR"}).format(a),E=a=>{const d=a.qty_available-a.qty_reserved;return d<=0?"out":d<a.min_stock?"low":"ok"},L=C?.filter(a=>E(a)==="low"||E(a)==="out")||[],pe=C?.reduce((a,d)=>a+d.qty_available*(d.sale_price||0),0)||0,ve=C?.reduce((a,d)=>a+d.qty_reserved,0)||0,ge=async a=>{try{const{data:d,error:S}=await ae.from("quote_items").select("quote_id").eq("inventory_item_id",a.id),{data:B,error:ke}=await ae.from("invoice_items").select("invoice_id").eq("inventory_item_id",a.id);if(S||ke)throw new Error("Nepodarilo sa skontrolovať referencie");const be=[...new Set((d||[]).map(Z=>Z.quote_id))],_e=[...new Set((B||[]).map(Z=>Z.invoice_id))];b(a),g(be),F(_e)}catch(d){console.error("Delete check error:",d),j.error("Nepodarilo sa skontrolovať možnosť vymazania")}},ye=async a=>{if(k)try{await ee.mutateAsync({id:k.id,forceDelete:a}),j.success("Položka vymazaná"),b(null),g([]),F([])}catch(d){console.error("Delete error:",d);const S=d?.message||"Nepodarilo sa vymazať položku";j.error(S)}},Ne=()=>{k&&(_(k),b(null),g([]),F([]))},fe=a=>{_(a)};return e.jsx(De,{title:"Sklad",children:e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-between",children:[e.jsxs("div",{className:"flex flex-1 gap-3",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(Pe,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(N,{placeholder:"Hľadať podľa názvu, SKU...",value:u,onChange:a=>r(a.target.value),className:"pl-9"})]}),e.jsxs(G,{value:t,onValueChange:i,children:[e.jsx(J,{className:"w-40",children:e.jsx(W,{placeholder:"Kategória"})}),e.jsxs(X,{children:[e.jsx(T,{value:"all",children:"Všetky"}),he?.map(a=>e.jsx(T,{value:a.id,children:a.name},a.id))]})]})]}),(I||l?.role==="manager")&&e.jsx(ss,{})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[e.jsx(P,{className:"shadow-soft",children:e.jsx(q,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Položky na sklade"}),D?e.jsx(h,{className:"h-8 w-16 mt-1"}):e.jsx("p",{className:"text-2xl font-semibold",children:C?.length||0})]}),e.jsx(H,{className:"h-8 w-8 text-muted-foreground/50"})]})})}),e.jsx(P,{className:"shadow-soft",children:e.jsx(q,{className:"pt-6",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Hodnota skladu"}),D?e.jsx(h,{className:"h-8 w-24 mt-1"}):e.jsx("p",{className:"text-2xl font-semibold",children:se(pe)})]})})}),e.jsx(P,{className:"shadow-soft",children:e.jsx(q,{className:"pt-6",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Rezervované"}),D?e.jsx(h,{className:"h-8 w-16 mt-1"}):e.jsxs("p",{className:"text-2xl font-semibold",children:[ve," ks"]})]})})}),e.jsx(P,{className:`shadow-soft ${L.length>0?"border-warning":""}`,children:e.jsx(q,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Nízke zásoby"}),D?e.jsx(h,{className:"h-8 w-12 mt-1"}):e.jsx("p",{className:"text-2xl font-semibold text-warning",children:L.length})]}),L.length>0&&e.jsx(O,{className:"h-8 w-8 text-warning"})]})})})]}),e.jsx(P,{className:"shadow-soft",children:e.jsx(q,{className:"p-0",children:e.jsxs(oe,{children:[e.jsx(de,{children:e.jsxs(w,{children:[e.jsx(y,{children:"Položka"}),e.jsx(y,{children:"SKU"}),e.jsx(y,{children:"Kategória"}),e.jsx(y,{className:"text-center",children:"Dostupné"}),e.jsx(y,{className:"text-center",children:"Rezervované"}),e.jsx(y,{className:"text-right",children:"Predajná cena"}),e.jsx(y,{children:"Stav zásob"}),(I||l?.role==="manager")&&e.jsx(y,{className:"w-12"})]})}),e.jsx(me,{children:D?Array.from({length:5}).map((a,d)=>e.jsxs(w,{children:[e.jsx(c,{children:e.jsx(h,{className:"h-5 w-40"})}),e.jsx(c,{children:e.jsx(h,{className:"h-5 w-24"})}),e.jsx(c,{children:e.jsx(h,{className:"h-5 w-20"})}),e.jsx(c,{children:e.jsx(h,{className:"h-5 w-16"})}),e.jsx(c,{children:e.jsx(h,{className:"h-5 w-16"})}),e.jsx(c,{children:e.jsx(h,{className:"h-5 w-20"})}),e.jsx(c,{children:e.jsx(h,{className:"h-5 w-32"})}),(I||l?.role==="manager")&&e.jsx(c,{children:e.jsx(h,{className:"h-5 w-8"})})]},d)):C?.length===0?e.jsx(w,{children:e.jsx(c,{colSpan:I||l?.role==="manager"?8:7,className:"p-0",children:e.jsx(EmptyState,{icon:e.jsx(H,{className:"h-full w-full"}),title:"Sklad je prázdny",description:"Pridajte produkty a materiály do skladu pre lepšiu evidenciu.",action:{label:"Pridať položku",onClick:()=>setCreateDialogOpen(!0),icon:e.jsx(M,{className:"h-4 w-4"})}})})}):C?.map(a=>{const d=E(a),S=a.qty_available-a.qty_reserved,B=Math.min(100,S/a.min_stock*100);return e.jsxs(w,{className:"cursor-pointer hover:bg-muted/50",children:[e.jsx(c,{children:e.jsx("span",{className:"font-medium text-foreground",children:a.name})}),e.jsx(c,{children:e.jsx("code",{className:"text-sm text-muted-foreground bg-muted px-2 py-0.5 rounded",children:a.sku})}),e.jsx(c,{children:e.jsx(le,{variant:"secondary",children:a.category?.name||"-"})}),e.jsxs(c,{className:"text-center font-medium",children:[a.qty_available," ks"]}),e.jsxs(c,{className:"text-center text-muted-foreground",children:[a.qty_reserved," ks"]}),e.jsx(c,{className:"text-right font-medium",children:se(a.sale_price)}),e.jsx(c,{children:e.jsxs("div",{className:"w-32",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:`text-xs font-medium ${d==="out"?"text-destructive":d==="low"?"text-warning":"text-success"}`,children:d==="out"?"Vypredané":d==="low"?"Nízke":"OK"}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[S," ks"]})]}),e.jsx(Ge,{value:B,className:`h-1.5 ${d==="out"?"[&>div]:bg-destructive":d==="low"?"[&>div]:bg-warning":"[&>div]:bg-success"}`})]})}),(I||l?.role==="manager")&&e.jsx(c,{children:e.jsxs(He,{children:[e.jsx($e,{asChild:!0,children:e.jsx(f,{variant:"ghost",size:"icon-sm",children:e.jsx(Ve,{className:"h-4 w-4"})})}),e.jsxs(Qe,{align:"end",children:[e.jsxs(A,{onClick:()=>p(a),children:[e.jsx(es,{className:"h-4 w-4 mr-2"}),"Upraviť"]}),e.jsx(A,{onClick:()=>fe(a),children:"Pridať zásoby"}),e.jsx(A,{onClick:()=>n(a),children:"Zobraziť rezervácie"}),e.jsxs(A,{className:"text-destructive",onClick:()=>ge(a),children:[e.jsx(Je,{className:"h-4 w-4 mr-2"}),"Vymazať"]})]})]})})]},a.id)})})]})})}),e.jsx(as,{item:o,open:!!o,onOpenChange:a=>!a&&p(null)}),e.jsx(ts,{item:s,open:!!s,onOpenChange:a=>!a&&n(null)}),e.jsx(rs,{open:!!m,onOpenChange:a=>!a&&_(null),itemId:m?.id||"",itemName:m?.name||"",currentStock:m?.qty_available||0}),e.jsx(ns,{open:!!k,onOpenChange:a=>{a||(b(null),g([]),F([]))},itemName:k?.name||"",affectedQuotes:z,affectedInvoices:xe,onConfirm:ye,onAdjustStockInstead:Ne,isDeleting:ee.isPending})]})})}export{gs as default};
