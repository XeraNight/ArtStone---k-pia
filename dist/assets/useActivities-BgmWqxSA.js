import{c as u,u as s,o as f,s as c}from"./index-ixxTEzIM.js";import{u as d}from"./ThemeToggle-mam2t0E5.js";import{u as m}from"./AppLayout-BqQJj8es.js";import{demoActivities as y}from"./demoData-tljgfLqM.js";const h=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],P=u("calendar",h);const p=[["path",{d:"M21 9a2.4 2.4 0 0 0-.706-1.706l-3.588-3.588A2.4 2.4 0 0 0 15 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2z",key:"1dfntj"}],["path",{d:"M15 3v5a1 1 0 0 0 1 1h5",key:"6s6qgf"}]],w=u("sticky-note",p);function v(e){const i=new Date().getTime()-e.getTime(),r=Math.floor(i/(1e3*60)),n=Math.floor(i/(1e3*60*60)),t=Math.floor(i/(1e3*60*60*24));return r<1?"Práve teraz":r===1?"Pred 1 minútou":r<5?`Pred ${r} minútami`:r<60?`Pred ${r} min`:n===1?"Pred 1 hodinou":n<24?`Pred ${n} hod`:t===1?"Pred 1 dňom":t<7?`Pred ${t} dňami`:t<14?"Pred týždňom":t<30?`Pred ${Math.floor(t/7)} týždňami`:e.toLocaleDateString("sk-SK")}function k(e){const{isDemo:a}=s();return d({queryKey:["activities",e,a],queryFn:async()=>{if(a){let t=[...y];return e?.entityType&&(t=t.filter(o=>o.entity_type===e.entityType)),e?.entityId&&(t=t.filter(o=>o.entity_id===e.entityId)),e?.limit&&(t=t.slice(0,e.limit)),t}let i=c.from("activities").select("*").order("created_at",{ascending:!1});e?.entityType&&(i=i.eq("entity_type",e.entityType)),e?.entityId&&(i=i.eq("entity_id",e.entityId)),e?.limit&&(i=i.limit(e.limit));const{data:r,error:n}=await i;if(n)throw n;return r}})}function g(){const e=f(),{user:a}=s();return m({mutationFn:async i=>{const{data:r,error:n}=await c.from("activities").insert({...i,created_by:a?.id}).select().single();if(n)throw n;return r},onSuccess:()=>{e.invalidateQueries({queryKey:["activities"]}),e.invalidateQueries({queryKey:["recent-activities"]})}})}function D(e=5){const{user:a,isDemo:i}=s();return d({queryKey:["recent-activities",e,a?.id,i],queryFn:async()=>{if(i)return y.slice(0,e).map(o=>({...o,time:"Pred 1 hod",user:"Demo používateľ"}));let r=c.from("activities").select("*").order("created_at",{ascending:!1}).limit(e);a?.role==="sales"&&(r=r.eq("created_by",a.id));const{data:n,error:t}=await r;return t?(console.error("Error fetching activities:",t),[]):(n||[]).map(o=>({...o,type:o.activity_type,time:v(new Date(o.created_at)),user:"Používateľ"}))},enabled:!!a,refetchInterval:3e4,refetchOnMount:!0,refetchOnWindowFocus:!0})}export{P as C,w as S,k as a,g as b,D as u};
